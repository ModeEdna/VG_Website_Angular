<div class="product-page-container">
  <div class="controls-section">
    <!-- Search bar on the left -->
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        placeholder="Search products..."
        [(ngModel)]="searchQuery"
        (input)="applyFilters()"
      />
      <i class="search-icon bi bi-search"></i>
      <button class="clear-search" *ngIf="searchQuery" (click)="clearSearch()">
        Ã—
      </button>
    </div>

    <div class="right-controls">
      <!-- Department filter - now with multiple selection -->
      <div class="department-filter">
        <button (click)="toggleDepartmentDropdown($event)">
          Departments <i class="bi bi-filter"></i>
        </button>
        <div class="dropdown-content" [class.show]="showDepartmentDropdown">
          <label>
            <input
              type="checkbox"
              [checked]="isAllDepartmentsSelected()"
              (change)="toggleAllDepartments()"
            />
            All Departments
          </label>
          <label *ngFor="let dept of availableDepartments">
            <input
              type="checkbox"
              [checked]="selectedDepartments.includes(dept)"
              (change)="toggleDepartment(dept)"
            />
            {{ dept }}
          </label>
        </div>
      </div>

      <!-- Favorites button with counter -->
      <div class="favorites-container">
        <button class="favorites-button" (click)="toggleFavoritesFilter()">
          <i
            class="bi"
            [ngClass]="{
              'bi-heart': !showOnlyFavorites,
              'bi-heart-fill': showOnlyFavorites
            }"
          ></i>
          Favorites
          <span class="favorites-count" *ngIf="favoritesCount > 0">{{
            favoritesCount
          }}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="product-cards-container">
    <div *ngFor="let product of filteredProducts">
      <a [href]="product.hyperlink" target="_blank">
        <div class="product-card">
          <div class="favorite-icon" (click)="toggleFavorite($event, product)">
            <i
              class="bi"
              [ngClass]="{
                'bi-heart': !isFavorite(product),
                'bi-heart-fill': isFavorite(product)
              }"
            ></i>
          </div>
          <h2 class="product-title">{{ product.title }}</h2>
          <p class="date">{{ product.date }}</p>
          <div class="depts-facilities-container">
            <div class="departments">
              <span *ngFor="let dept of product.departments">{{ dept }}</span>
            </div>
            <div class="facilities">
              <span *ngFor="let facility of product.facilities">{{
                facility
              }}</span>
            </div>
          </div>
          <p class="product-description">{{ product.description }}</p>
        </div>
      </a>
    </div>
  </div>
</div>
